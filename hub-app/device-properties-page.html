<link rel="import" href="../bower_components/polymer-filters/polymer-filters.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">

<polymer-element name="device-properties-page" attributes="device" fit vertical layout auto>
  <template>

    <link rel="stylesheet" href="device-properties-page.css">

    <template repeat="{{prop in properties | orderBy('key') | booleanFirst}}">

      <template if="{{prop.isBoolean}}">
        <div class="prop-item" horizontal layout>
          <span flex>{{prop.key | capitalize}}</span>
          <paper-toggle-button checked="{{prop.value}}"></paper-toggle-button>
        </div>
      </template>

      <template if="{{!prop.isBoolean}}">
        <div class="prop-item" horizontal layout center>
          <div vertical layout flex>
            <span>{{prop.key | capitalize}}</span>
            <span class="value">{{prop.value}}</span>
          </div>

          <paper-icon-button icon="create" on-tap={{updateProperty}}
                             data-property-key="{{prop.key}}"
                             data-property-value="{{prop.value}}">
          </paper-icon-button>

        </div>
      </template>

      <paper-action-dialog id="updateProperty" heading="Update {{selected.key}}" backdrop>
        <paper-input-decorator floatingLabel label="New value">
          <input type="number" is="core-input" value="{{selected.value}}" placeholder="E.g. 20, Light blue">
        </paper-input-decorator>

        <paper-button dismissive>Cancel</paper-button>
        <paper-button affirmative autofocus>Update</paper-button>
      </paper-action-dialog>

    </template>

  </template>
  <script>
    Polymer('device-properties-page', {

      properties: [{
        key: 'proximity',
        value: 10,
        isBoolean: false
      }, {
        key: 'status',
        value: true,
        isBoolean: true
      },{
        key: 'color',
        value: 'blue',
        isBoolean: false
      }, {
        key: 'boolean',
        value: false,
        isBoolean: true
      }, {
        key: 'number',
        value: 235,
        isBoolean: false
      }],

      booleanFirst: function (input) {
        var lastBooleanIndex = 0,
            ret = [];

        for(var i = 0; i< input.length; i++){
          if(input[i].isBoolean){
            ret.splice(lastBooleanIndex++, 0, input[i]);
          } else {
            ret.push(input[i]);
          }
        }

        return ret;
      },

      updateProperty: function (event, detail, target) {
        this.selected = {
          key: target.attributes['data-property-key'].value,
          value: target.attributes['data-property-value'].value
        };

        this.$.updateProperty.open();
      }

    });
  </script>
</polymer-element>
